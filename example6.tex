% ----------------------------------------------------------------------
\begin{frame}[fragile]{Recursion}

$
P
=
\left\{
    \{ p \} \leftarrow, \ \
    \alert<1>{\{q\} \leftarrow r}, \ \
    \alert<1>{\{r\} \leftarrow p}, \ \
    %\{p\} \leftarrow \alt<17->{\alert{\naf{q}}}{q}
    \alert<1>{\{p\} \leftarrow q}
\right\}
$

\vspace{0.2cm}
\begin{center}
\begin{tikzpicture}
[
  examples,
  x=1cm,
  y=-1cm,
  every node/.style={node distance=1.2cm and 1cm, on grid},
  small/.style={inner sep=0.5mm},
  rule_dep/.style={align=center, draw},
  rule_arrow/.style={<-},
  cycle_arrow/.style={rule_arrow, dotted, thick, shorten <= 0.5mm, shorten >= 0.5mm},
  rule_arrow_neg/.style={rule_arrow, dashed},
]


%
% smodel
%

% line 0
%\uncover<2->{\alert<2>{
\node[smodel] (node01)  at ( 0, 0) {};
%}}


%
% correct models
%

% line 1
\node[smodel, below left=of  node01] (node11) {}    edge [arrow] (node01);
\node[smodel, below right=of node01] (node12) {$p$} edge [arrow] (node01);

\only<-4>{
% line 2
\uncover<2-4>{\alert<2>{
\node[smodel, below=of  node11]                         (node21) {}        edge [cycle_arrow] (node11);
\node[smodel, below left=of  node12, small, xshift=0mm] (node22) {$p$}     edge [cycle_arrow] (node12);
\node[smodel, below right=of node12, small, xshift=0mm] (node23) {$p$ $r$} edge [cycle_arrow] (node12);
}}

% line 3
\uncover<3-4>{\alert<3>{
\node[smodel, below=of  node21]                            (node31) {}            edge [cycle_arrow] (node21);
\node[smodel, below=of  node22, small]                     (node32) {$p$}         edge [cycle_arrow] (node22);
\node[smodel, below left=of  node23, xshift=0mm, small] (node33) {$p$ $r$}     edge [cycle_arrow] (node23);
\node[smodel, below right=of node23, xshift=0mm, small] (node34) {$p$ $r$ $q$} edge [cycle_arrow] (node23);
\draw[cycle_arrow,->] (node22) -- (node33);
}}

% line 4
\uncover<4>{\alert<4>{
\node[smodel, below=of node31]        (node41) {}            edge [cycle_arrow] (node31);
\node[smodel, below=of node32, small] (node42) {$p$}         edge [cycle_arrow] (node32);
\node[smodel, below=of node33, small] (node43) {$p$ $r$}     edge [cycle_arrow] (node33);
\node[smodel, below=of node34, small] (node44) {$p$ $r$ $q$} edge [cycle_arrow] (node34);
\draw[cycle_arrow,->] (node32) -- (node43);
\draw[cycle_arrow,->] (node33) -- (node44);
}}

} %\only

% line 2
\visible<5->{\alert<5>{
\node[smodel, below=of node11]                            (node21) {}            edge [arrow] (node11);
\node[smodel, below left=of node12, small]   (node22) {$p$}         edge [arrow] (node12);
\node[smodel, below=of node12, small] (node23) {$p$ $r$}     edge [arrow] (node12);
\node[smodel, below right=of node12, small, xshift=5mm] (node24) {$p$ $r$ $q$} edge [arrow] (node12);
}}

\visible<6->{
\node[any] (ok1) at ($ (node21.south east) + (2mm,0) $) {\OK};
\node[any] (ok2) at ($ (node22.south east) + (2mm,0) $) {\OK};
\node[any] (ok3) at ($ (node23.south east) + (2.5mm,0) $) {\OK};
\node[any] (ok4) at ($ (node24.south east) + (3mm,0) $) {\OK};
}

%
% rule sequence
%

\node[rule, right=of node12, xshift=3cm] (rule_seq_1) {\alt<7>{\scode \{p\}.\hspace{9mm}}{$\{p\} \leftarrow$}};

\alert<1>{
\node[rule, below=of rule_seq_1] (rule_seq_2) {\alt<7>{\scode \{q\} :- r.}{$\{q\} \leftarrow r$}};
\node[rule, below=of rule_seq_2, yshift=7mm] (rule_seq_3) {\alt<7>{\scode \{r\} :- p.}{$\{r\} \leftarrow p$}};
\node[rule, below=of rule_seq_3, yshift=7mm] (rule_seq_4) {\alt<7>{\scode \{p\} :- q.}{$\{p\} \leftarrow q$}};
}

% rectangle
%\only<9-14>{\alert<9>{
\visible<-6>{\alert<1>{
\draw[very thick, dotted, rounded corners] 
  ($ (rule_seq_2.north west) + (1mm,1mm) $) rectangle ($ (rule_seq_4.south east) + (-1mm,-1mm) $);
}}


% box
\visible<7>{
 \draw[on grid] ($ (rule_seq_1.north west) + (0mm,-0.1) $) rectangle ($ (rule_seq_4.south east) + (-0.5mm,0.1) $);
 \node[on grid] at ($ (rule_seq_1.north) + (0mm,3.5mm) $) {\texttt{example.lp}};
}

\end{tikzpicture}
\end{center}

\end{frame}
