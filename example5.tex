
% ----------------------------------------------------------------------
\begin{frame}[fragile]{Recursion}

$
P
=
\left\{
    \{ p \} \leftarrow, \ \
    q \leftarrow r, \ \
    r \leftarrow p, \ \
    p \leftarrow q
\right\}
$

\vspace{0.2cm}
\begin{center}
\begin{tikzpicture}
[
  examples,
  x=1cm,
  y=-1cm,
  every node/.style={node distance=1.2cm and 1cm, on grid},
  small/.style={inner sep=0.5mm},
  rule_dep/.style={align=center, draw},
  rule_arrow/.style={<-},
  cycle_arrow/.style={rule_arrow, dotted, thick},
  rule_arrow_neg/.style={rule_arrow, dashed},
]


%
% smodel
%

% line 0
\uncover<2->{\alert<2>{
\node[smodel] (node01)  at ( 0, 0) {};
}}

% line 1
\uncover<3->{\alert<3>{
\node[smodel, below left=of  node01] (node11) {}    edge [arrow] (node01);
\node[smodel, below right=of node01] (node12) {$p$} edge [arrow] (node01);
}}

%
% wrong models
%

\only<-8>{
% line 2
\uncover<4-8>{\alert<4>{
\node[smodel, below=of  node11] (node21) {}    edge [arrow] (node11);
\node[smodel, below=of  node12] (node22) {$p$} edge [arrow] (node12);
}}

% line 3
\uncover<5-8>{\alert<5>{
\node[smodel, below=of  node21] (node31) {}    edge [arrow] (node21);
\node[smodel, below=of  node22] (node32) {$p$ $r$} edge [arrow] (node22);
}}

% line 4
\uncover<6-8>{\alert<6>{
\node[smodel, below=of  node31] (node41) {}    edge [arrow] (node31);
\node[smodel, below=of  node32] (node42) {$p$ $r$} edge [arrow] (node32);
}}
} %\only

%
% correct models
%

% line 2
\visible<10-12>{\alert<10>{
\node[smodel, below=of  node11] (node21) {}        edge [cycle_arrow] (node11);
\node[smodel, below=of  node12] (node22) {$p$ $r$} edge [cycle_arrow] (node12);
}}

% line 3
\visible<11-12>{\alert<11>{
\node[smodel, below=of  node21] (node31) {}            edge [cycle_arrow] (node21);
\node[smodel, below=of  node22] (node32) {$p$ $r$ $q$} edge [cycle_arrow] (node22);
}}

% line 4
\visible<12>{\alert<12>{
\node[smodel, below=of  node31] (node41) {}            edge [cycle_arrow] (node31);
\node[smodel, below=of  node32] (node42) {$p$ $r$ $q$} edge [cycle_arrow] (node32);
}}

% line 2
\visible<13->{\alert<13>{
\node[smodel, below=of  node11] (node21) {}            edge [arrow] (node11);
\node[smodel, below=of  node12] (node22) {$p$ $r$ $q$} edge [arrow] (node12);
}}

\visible<14->{
\node[any, below=of node12, xshift=9.5mm, yshift=-2mm] (ok) {\OK};
\node[any, below=of node11, xshift=4.5mm, yshift=-2mm] (ok) {\OK};
}

%
% rule sequence
%

\uncover<3->{\alert<3>{
\node[rule, right=of node12, xshift=1.1cm] (rule_seq_1) {\alt<15>{\scode \{p\}.\hspace{8mm}}{$\{p\} \leftarrow$}};
}}

\uncover<4->{\alert<4,9>{
\node[rule, below=of rule_seq_1] (rule_seq_2) {\alt<15>{\scode q :- r.}{$q \leftarrow r$}};
}}

\only<-8>{
\uncover<5-8>{\alert<5>{
\node[rule, below=of rule_seq_2] (rule_seq_3) {$r \leftarrow p$};
}}

\uncover<6-8>{\alert<6>{
\node[rule, below=of rule_seq_3] (rule_seq_4) {$p \leftarrow q$};
}}
} %\only

\only<9->{\alert<9>{
\node[rule, below=of rule_seq_2, yshift=7mm] (rule_seq_3) {\alt<15>{\scode r :- p.}{$r \leftarrow p$}};
\node[rule, below=of rule_seq_3, yshift=7mm] (rule_seq_4) {\alt<15>{\scode p :- q.}{$p \leftarrow q$}};
}}

% rectangle
\only<9-14>{\alert<9>{
\draw[very thick, dotted, rounded corners] 
  ($ (rule_seq_2.north west) + (3mm,1mm) $) rectangle ($ (rule_seq_4.south east) + (-3mm,-0mm) $);
}}


% KO
\visible<8>{\node[any, below=of node12, yshift=-6mm, xshift=10mm] (ko) {\BigBigKO};}

% box
\visible<15>{
 \draw[on grid] ($ (rule_seq_1.north west) + (1.5mm,-0.1) $) rectangle ($ (rule_seq_4.south east) + (-2mm,0.1) $);
 \node[on grid] at ($ (rule_seq_1.north) + (0mm,3.5mm) $) {\texttt{example.lp}};
}

\end{tikzpicture}
\end{center}

\begin{tikzpicture}[remember picture,overlay]
\visible<7-8>{\node at (10,3) {\Large{\textbf{\alert{Not in order}}}};}
\end{tikzpicture}

\end{frame}
